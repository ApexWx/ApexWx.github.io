<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>NWS Alerts - Fort Kent, ME</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      padding: 20px;
    }

    h1 {
      text-align: center;
    }

    #nws-alerts-container {
      max-width: 700px;
      margin: 20px auto;
    }

    .nws-alert {
      border-left: 6px solid;
      padding: 12px 16px;
      margin: 10px 0;
      border-radius: 6px;
      position: relative;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .nws-alert .close-btn {
      position: absolute;
      right: 10px;
      top: 8px;
      background: transparent;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: inherit;
    }

    .severity-Minor {
      background: #e7f3fe;
      border-color: #2196F3;
    }

    .severity-Moderate {
      background: #fff3cd;
      border-color: #ff9800;
    }

    .severity-Severe {
      background: #f8d7da;
      border-color: #f44336;
    }

    .severity-Extreme {
      background: #b71c1c;
      border-color: #b71c1c;
      color: white;
    }

    .nws-alert p {
      margin: 8px 0 0;
    }
  </style>
  </head>
  <body>
    <h1>National Weather Service Alerts<br>
      Fort Kent, ME</h1>
    <div id="nws-alerts-container">
      <p>Loading alerts...</p>
    </div>
    <script>
    const ALERTS_CONTAINER_ID = 'nws-alerts-container';
    const Lancaster_PA_ZONE = 'PAZ066';  // Lancaster, PA
    const FETCH_INTERVAL = 5 * 60 * 1000;  // Refresh every 5 minutes

    function getAlertColorClass(severity) {
      const levels = ['Minor', 'Moderate', 'Severe', 'Extreme'];
      return levels.includes(severity) ? `severity-${severity}` : 'severity-Minor';
    }

    function createAlertBox(alert) {
      const div = document.createElement('div');
      div.className = `nws-alert ${getAlertColorClass(alert.severity)}`;

      div.innerHTML = `
        <strong>${alert.event}</strong><br>
        <small><em>${alert.senderName}</em></small><br>
        ${alert.headline ? `<p>${alert.headline}</p>` : ''}
        <button class="close-btn" onclick="this.parentElement.remove();">&times;</button>
      `;

      return div;
    }

    async function fetchAndDisplayAlerts() {
      const container = document.getElementById(ALERTS_CONTAINER_ID);
      container.innerHTML = '';  // Clear old alerts

      try {
        const res = await fetch(`https://api.weather.gov/alerts/active/zone/${Lancaster_PA_ZONE}`);
        const data = await res.json();

        if (!data.features.length) {
          container.innerHTML = '<p>No active alerts at this time.</p>';
          return;
        }

        data.features.forEach(feature => {
          const alert = feature.properties;
          const alertBox = createAlertBox(alert);
          container.appendChild(alertBox);
        });

      } catch (err) {
        console.error('Error fetching NWS alerts:', err);
        container.innerHTML = '<p>Error fetching alerts. Please try again later.</p>';
      }
    }

    fetchAndDisplayAlerts();
    setInterval(fetchAndDisplayAlerts, FETCH_INTERVAL);
  </script>
  </body>
</html>
