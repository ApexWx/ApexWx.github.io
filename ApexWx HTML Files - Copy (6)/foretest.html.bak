<div id="forecast"></div>
<div id="forecast-updated" style="font-size: 0.9em; color: #666; margin-top: 0.5em;"></div>

<script>
  async function fetchForecast() {
    try {
      const pointResponse = await fetch('https://api.weather.gov/points/47.25,-68.58');
      if (!pointResponse.ok) throw new Error("Point request failed");
      const pointData = await pointResponse.json();

      const forecastUrl = pointData?.properties?.forecast;
      if (!forecastUrl) throw new Error("Forecast URL not found");

      const forecastResponse = await fetch(forecastUrl);
      if (!forecastResponse.ok) throw new Error("Forecast request failed");
      const forecastData = await forecastResponse.json();

      const periods = forecastData?.properties?.periods;
      const updatedTime = forecastData?.properties?.updated;
      if (!periods || !updatedTime) throw new Error("Missing forecast data or timestamp");

      const forecastHtml = periods.map(p => `
        <div class="fw-item">
          <img src="${p.icon}" alt="${p.shortForecast}" />
          <div class="fw-text">
            <span class="fw-day">${p.name}:</span> ${p.detailedForecast}
          </div>
        </div>
      `).join('');

      document.getElementById('forecast').innerHTML = forecastHtml;

      // Format the updated time
      const updatedDate = new Date(updatedTime);
      const updatedString = updatedDate.toLocaleString(undefined, {
        dateStyle: 'medium',
        timeStyle: 'short'
      });

      document.getElementById('forecast-updated').textContent = `Last updated by NWS: ${updatedString}`;
    } catch (error) {
      console.error('Error fetching weather:', error);
      document.getElementById('forecast').textContent = 'Failed to load forecast.';
      document.getElementById('forecast-updated').textContent = '';
    }
  }

  fetchForecast();
  setInterval(fetchForecast, 10800000);
</script>
